---
order: 3
title: Router and Nav
type: Introduction
---

Routes and menus are the key skeletons of an application, we provide some basic tools and templates to help you build your own routes/menus more easily.

If you want to know more about `browserHistory` and `hashHistory`, see [deploy](/docs/deploy).

> Note: Our scaffold relys on `dva@2`, thus the routing is based on `react-router@4`, in which the API is quite different from that before, here are some references of basic knowledge:

>
  - [react-router](https://reacttraining.com/react-router/web/guides/philosophy)
  - [Migrating from v2/v3 to v4](https://github.com/ReactTraining/react-router/blob/master/packages/react-router/docs/guides/migrating.md)
  - [dva@2.0](https://github.com/sorrycc/blog/issues/48)
  - [Webpack Code Splitting](https://webpack.js.org/guides/code-splitting/)

---

## Basic Structure

The scaffold has built up the basic framework of routes and menus by combining some configuration files, basic algorithms and tool functions, which mainly contains the following modules/functions:

- `Routes Building` By combining configuration files and preset algorithms, we provide the ability to generate routes lists in files of different levels automatically.
- `Menus Building` It is built through a menu configuration file which has a determined data structure, the title of the menu item and the nested path has a certain relationship with the route.
- `Breadcrumb` The breadcrumb in [PageHeader](http://pro.ant.design/components/PageHeader) can be generated by the configuration files in the scaffold.

Below is a brief introduction to the basic ideas of each module, if you are not interested in the design principle, you can jump to [Examples](/docs/router-and-nav#Examples) directly to find out how to meet your needs.

### Routes

The routes list is generated automatically in our scaffold(except [root routes](https://github.com/ant-design/ant-design-pro/blob/master/src/router.js)). The configuration file `src/common/router.js` is the most critical part, which has two main functions:

- Configuring routing related info. You just need to specify the path and component for each item(if you only want to build a routes list).
- Output the routerData, and mount it on the components corresponding to each route.

Now we get a basic routes info object, the structure is generally like this:

```js
{
  '/dashboard/analysis': {
    component: DynamicComponent(),
    name: 'Analysis',
  },
  '/dashboard/monitor': {
    component: DynamicComponent(),
    name: 'Monitor',
  },
  '/dashboard/workplace': {
    component: DynamicComponent(),
    name: 'Workplace',
  },
}
```

We provide a tool function `getRoutes` in `src/utils/utils.js` to help routes building, which accepts two params: current [match](https://reacttraining.com/react-router/web/api/match) and routerData, the main purpose of `getRoutes` is:

- To filter the routes info. The algorithm is: **Only keep the nearest routing level under the current match.path(We defaults that the deeper layers need to be left to nested rendering in subcomponents)**. For example:

  ```js
  // current match.path is /
  /a                 // no nearer level, preserve
  /a/b               // a nearer level /a exists, remove
  /c/d               // no nearer level, preserve
  /c/e               // no nearer level, preserve
  /c/e/f             // a nearer level /c/e exists, remove
  ```
- To analysis the [exact](https://reacttraining.com/react-router/web/api/Route/exact-bool) param. The route path will be set exact unless it has nested paths.

Now we can build our routes list:

```js
// src/layouts/BasicLayout.js
getRoutes(match.path, routerData).map(item => (
  <Route
    key={item.key}
    path={item.path}
    component={item.component}
    exact={item.exact}
  />
))
```

> Note: If you do not need the filtering and analysis function, you can ignore `getRoutes` and build your routes list based on routerData.

### Menus

The menu info is configured in `src/common/menu.js`, its role is:

- To organize the menu data, **the generated link for the menu item is the path combination of the item self and its parents.**
- To provide page name for routes in `src/common/router.js`, **we use the generated link to match the corresponding route.**

> You can specify the name info in `src/common/router.js` directly if you do not need a menu in your project.

The output data of `src/common/menu.js` can be used directly by [SiderMenu](https://github.com/ant-design/ant-design-pro/blob/master/src/components/SiderMenu/SiderMenu.js) components, besides that, it can also assist in redirect routes building, refer to [BasicLayout.js#L154](https://github.com/ant-design/ant-design-pro/blob/master/src/layouts/BasicLayout.js#L154).

### Breadcrumb

The routerData can be used by PageHeader to build a breadcrumb, props or context are both support, [examples](https://github.com/ant-design/ant-design-pro/blob/master/src/layouts/BasicLayout.js#L76).

## Examples

Let's find out how to do through some cases.

### New Pages

There are two kinds of layout template: `BasicLayout` and `UserLayout`.

<img alt="BasicLayout" src="https://gw.alipayobjects.com/zos/rmsportal/oXmyfmffJVvdbmDoGvuF.png" />

<img alt="UserLayout" src="https://gw.alipayobjects.com/zos/rmsportal/mXsydBXvLqBVEZLMssEy.png" />

You just need to add one item in the routes/menus configuration file if your pages can be based on these templates:

```js
// src/common/router.js
'/dashboard/test': {
  component: dynamicWrapper(app, ['monitor'], () => import('../routes/Dashboard/Test')),
},
```

```js
// src/common/menu.js
const menuData = [{
  name: 'dashboard',
  icon: 'dashboard',  // https://demo.com/icon.png or <Icon type="dashboard" />
  path: 'dashboard',
  children: [{
    name: 'Analysis',
    path: 'analysis',
  }, {
    name: 'Monitor',
    path: 'monitor',
  }, {
    name: 'Workplace',
    path: 'workplace',
  }, {
    name: 'Test',
    path: 'test',
  }],
}, {
  // more
}];
```

The corresponding route and menu will be generated automatically.

### New Layout

If the layout can not meet your demands, you should build your own. Suppose there are two new pages that need to use a new template, first you need to add new setting about route and menu:

```js
// src/common/router.js
'/new': {
  component: dynamicWrapper(app, ['monitor'], () => import('../layouts/NewLayout')),
},
'/new/page1': {
  component: dynamicWrapper(app, ['monitor'], () => import('../routes/New/Page1')),
},
'/new/page2': {
  component: dynamicWrapper(app, ['monitor'], () => import('../routes/New/Page2')),
},
```

```js
// src/common/menu.js
const menuData = [{
  name: 'New Layout',
  icon: 'table',
  path: 'new',
  children: [{
    name: 'Page1',
    path: 'page1',
  }, {
    name: 'Page2',
    path: 'page2',
  }],
}, {
  // more
}];
```

Add the new layout to root routes:

```js
// src/router.js
<Router history={history}>
  <Switch>
    <Route path="/new" render={props => <NewLayout {...props} />} />
    <Route path="/user" render={props => <UserLayout {...props} />} />
    <Route path="/" render={props => <BasicLayout {...props} />} />
  </Switch>
</Router>
```

Now you can build the routes list in your new template follow the way of `src/layouts/BasicLayout.js` or `src/layouts/UserLayout.js`.

### Route/menu With Params

You can add a route/menu path with params like this:

```js
// src/common/router.js
'/dashboard/:workplace': {
  component: dynamicWrapper(app, ['chart'], () => import('../routes/Dashboard/Workplace')),
},
'/:list/table-list': {
  component: dynamicWrapper(app, ['rule'], () => import('../routes/List/TableList')),
},
```

```js
// src/common/menu.js
const menuData = [{
  name: 'dashboard',
  icon: 'dashboard',
  path: 'dashboard',
  children: [{
    name: 'Analysis',
    path: 'analysis',
  }, {
    name: 'Monitor',
    path: 'monitor',
  }, {
    name: 'Workplace',
    path: ':workplace',
  }],
}, {
  name: 'List',
  icon: 'table',
  path: ':list',
  children: [],
}, {
  // more
}];
```

### Nested Layout

Sometimes we need to nest other templates in the current layout, for example, there are several pages that need to display the same module, you can extract this part and turn it into a new layout, and build a routes list in it. In this case you do not need to add it to the root routes, that's different from [New Layout](/docs/router-and-nav#New Layout). For details, please refer to the config setting of /list/search in`src/common/router.js` and relevant files.

### Render Nested Route

We use `getRoutes` to deal with routerData to generate routes list by default, according to the [algorithms](/docs/router-and-nav#Routes), only the nearest routing level under the current match.path will be kept. If you need to render a deeper level route(For instance: render `/list/search` and `/list/search/projects` at the same level), you need to get the route data manually and add it to the proper place.

```jsx
{/* src/layouts/BasicLayout.js as your wrapper component */}
<Content style={{ margin: '24px 24px 0', height: '100%' }}>
  <div style={{ minHeight: 'calc(100vh - 260px)' }}>
    <Switch>
      {/* default routes list, do not contain /list/search/projects */}
      {
        getRoutes(match.path, routerData).map(item => (
          <Route
            key={item.key}
            path={item.path}
            component={item.component}
            exact={item.exact}
          />
        ))
      }
      {/* /list/search/projects added */}
      <Route exact path="/list/search/projects" component={routerData['/list/search/projects'].component} />
      <Redirect exact from="/" to="/dashboard/analysis" />
      <Route render={NotFound} />
    </Switch>
  </div>
</Content>
```

If there is a nested layout to be rendered, you need to remove the duplicated route in it.

```jsx
{/* src/routes/List/List.js the nested layout */}
<Switch>
  {
    getRoutes(match.path, routerData).filter(item => item.path !== '/list/search/projects').map(item =>
      (
        <Route
          key={item.key}
          path={item.path}
          component={item.component}
          exact={item.exact}
        />
      )
    )
  }
</Switch>
```

> If most of the routes in your project need to be rendered at the same level, you can remove the getRoutes calling. 

### Hide Menu Item

You can add `hideInMenu` to the item that you want to hide.

```js
// src/common/menu.js
const menuData = [{
  name: 'dashboard',
  icon: 'dashboard',
  path: 'dashboard',
  children: [{
    name: 'Analysis',
    path: 'analysis',
  }, {
    name: 'Monitor',
    path: 'monitor',
  }, {
    name: 'Workplace',
    path: 'workplace',
    hideInMenu: true,  // hidden
  }],
}, {
  name: 'Form',
  icon: 'form',
  path: 'form',
  hideInMenu: true,  // hidden
  children: [{
    name: 'Basic Form',
    path: 'basic-form',
  }, {
    name: 'Step Form',
    path: 'step-form',
  }, {
    name: 'Advanced Form',
    path: 'advanced-form',
  }],
}, {
  // more
}];
```

### Hide Breadcrumb Item

You can add `hideInBreadcrumb` to the item that you want to hide.

```js
// src/common/router.js
'/dashboard/analysis': {
  component: dynamicWrapper(app, ['chart'], () => import('../routes/Dashboard/Analysis')),
  hideInBreadcrumb: true,  // hidden
},
'/dashboard/monitor': {
  component: dynamicWrapper(app, ['monitor'], () => import('../routes/Dashboard/Monitor')),
},
```

## FAQ

### Some of my route items were lost?

We use [getRoutes](https://github.com/ant-design/ant-design-pro/blob/master/src/utils/utils.js) to deal with the route data by default, for route path like `/ant-design/ant-design-pro`, we defaults that you want it to be rendered in `/ant-design`(if exists), so `/ant-design/ant-design-pro` will not be rendered at the same level of `/ant-design`. If you need to render them at the same place, please refer to [Render Nested Route](/docs/router-and-nav#Render Nested Route).

### `Link` to

The `to` property turns to be required in `react-router@4`, and there will be lots of errors and warnings if it is undefined, so pay attention. Docs and issues:

- [react-router@4 Link](https://reacttraining.com/react-router/web/api/Link)
- [discussion](https://github.com/ReactTraining/react-router/pull/5271)

### About dynamicWrapper

```js
import dynamic from 'dva/dynamic';

// wrapper of dynamic
const dynamicWrapper = (app, models, component) => dynamic({
  app,
  // eslint-disable-next-line no-underscore-dangle
  models: () => models.filter(m => !app._models.some(({ namespace }) => namespace === m)).map(m => import(`../models/${m}.js`)),
  // add routerData prop
  component: () => {
    const routerData = getRouterData(app);
    return component().then((raw) => {
      const Component = raw.default || raw;
      return props => <Component {...props} routerData={routerData} />;
    });
  },
});
```

We wrapped `dva/dynamic` for code simplicity, and it is important to note that here we use dynamic `import` of [Webpack Code Splitting](https://webpack.js.org/guides/code-splitting/), the `Promise` dynamic loading has been wrapped up by `dynamic` of `dva`, so we can use it directly.
